(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const N={442:{red:[{id:"GK",x:.05,y:.5},{id:"LE",x:.2,y:.15},{id:"ZAG",x:.2,y:.35},{id:"ZAG",x:.2,y:.65},{id:"LD",x:.2,y:.85},{id:"VOL",x:.35,y:.25},{id:"MC",x:.35,y:.5},{id:"MC",x:.35,y:.75},{id:"MEI",x:.48,y:.47},{id:"ATA",x:.65,y:.35},{id:"ATA",x:.65,y:.65}],blue:[{id:"GK",x:.95,y:.5},{id:"LE",x:.8,y:.15},{id:"ZAG",x:.8,y:.35},{id:"ZAG",x:.8,y:.65},{id:"LD",x:.8,y:.85},{id:"VOL",x:.65,y:.25},{id:"MC",x:.65,y:.5},{id:"MC",x:.65,y:.75},{id:"MEI",x:.52,y:.53},{id:"ATA",x:.35,y:.35},{id:"ATA",x:.35,y:.65}]},433:{red:[{id:"GK",x:.05,y:.5},{id:"LE",x:.2,y:.15},{id:"ZAG",x:.2,y:.35},{id:"ZAG",x:.2,y:.65},{id:"LD",x:.2,y:.85},{id:"VOL",x:.32,y:.5},{id:"MC",x:.42,y:.3},{id:"MC",x:.42,y:.7},{id:"PE",x:.58,y:.2},{id:"ATA",x:.65,y:.5},{id:"PD",x:.58,y:.8}],blue:[{id:"GK",x:.95,y:.5},{id:"LE",x:.82,y:.15},{id:"ZAG",x:.82,y:.35},{id:"ZAG",x:.82,y:.65},{id:"LD",x:.82,y:.85},{id:"VOL",x:.68,y:.5},{id:"MC",x:.58,y:.3},{id:"MC",x:.58,y:.7},{id:"PE",x:.42,y:.2},{id:"ATA",x:.35,y:.5},{id:"PD",x:.42,y:.8}]},352:{red:[{id:"GK",x:.05,y:.5},{id:"ZAG",x:.18,y:.25},{id:"ZAG",x:.18,y:.5},{id:"ZAG",x:.18,y:.75},{id:"LE",x:.32,y:.15},{id:"LD",x:.32,y:.85},{id:"VOL",x:.38,y:.5},{id:"MC",x:.45,y:.3},{id:"MC",x:.45,y:.7},{id:"ATA",x:.65,y:.35},{id:"ATA",x:.65,y:.65}],blue:[{id:"GK",x:.95,y:.5},{id:"ZAG",x:.82,y:.25},{id:"ZAG",x:.82,y:.5},{id:"ZAG",x:.82,y:.75},{id:"LE",x:.68,y:.15},{id:"LD",x:.68,y:.85},{id:"VOL",x:.62,y:.5},{id:"MC",x:.55,y:.3},{id:"MC",x:.55,y:.7},{id:"ATA",x:.35,y:.35},{id:"ATA",x:.35,y:.65}]},343:{red:[{id:"GK",x:.05,y:.5},{id:"ZAG",x:.18,y:.25},{id:"ZAG",x:.18,y:.5},{id:"ZAG",x:.18,y:.75},{id:"LE",x:.32,y:.15},{id:"LD",x:.32,y:.85},{id:"MC",x:.45,y:.3},{id:"MC",x:.45,y:.7},{id:"MEI",x:.48,y:.5},{id:"ATA",x:.65,y:.35},{id:"ATA",x:.65,y:.65}],blue:[{id:"GK",x:.95,y:.5},{id:"ZAG",x:.82,y:.25},{id:"ZAG",x:.82,y:.5},{id:"ZAG",x:.82,y:.75},{id:"LE",x:.68,y:.15},{id:"LD",x:.68,y:.85},{id:"MC",x:.55,y:.3},{id:"MC",x:.55,y:.7},{id:"MEI",x:.52,y:.5},{id:"ATA",x:.35,y:.35},{id:"ATA",x:.35,y:.65}]}},L={"3x3":{futsal:{backgroundImage:"https://i.imgur.com/UiOK7Gr.png",players:[{uid:1,id:"GK",team:"red",x:.1,y:.5,size:29},{uid:2,id:"VL",team:"red",x:.25,y:.25,size:29},{uid:3,id:"PV",team:"red",x:.25,y:.75,size:29},{uid:4,id:"GK",team:"blue",x:.9,y:.5,size:29},{uid:5,id:"VL",team:"blue",x:.75,y:.25,size:29},{uid:6,id:"PV",team:"blue",x:.75,y:.75,size:29},{uid:10,id:"",team:"ball",x:.5,y:.5,size:12}]},bigeasy:{backgroundImage:"https://i.imgur.com/rMetuYd.png",players:[{uid:1,id:"GK",team:"red",x:.1,y:.5,size:29},{uid:2,id:"VL",team:"red",x:.25,y:.25,size:29},{uid:3,id:"PV",team:"red",x:.25,y:.75,size:29},{uid:4,id:"GK",team:"blue",x:.9,y:.5,size:29},{uid:5,id:"VL",team:"blue",x:.75,y:.25,size:29},{uid:6,id:"PV",team:"blue",x:.75,y:.75,size:29},{uid:10,id:"",team:"ball",x:.5,y:.5,size:12}]}},"4x4":{futsal:{backgroundImage:"https://i.imgur.com/dZgIa0e.png",players:[{uid:1,id:"GK",team:"red",x:.1,y:.5,size:29},{uid:2,id:"VL",team:"red",x:.3,y:.3,size:29},{uid:3,id:"MC",team:"red",x:.3,y:.7,size:29},{uid:4,id:"PV",team:"red",x:.45,y:.5,size:29},{uid:5,id:"GK",team:"blue",x:.9,y:.5,size:29},{uid:6,id:"VL",team:"blue",x:.7,y:.3,size:29},{uid:7,id:"MC",team:"blue",x:.7,y:.7,size:29},{uid:8,id:"PV",team:"blue",x:.55,y:.5,size:29},{uid:10,id:"",team:"ball",x:.5,y:.5,size:12}]},bigeasy:{backgroundImage:"https://i.imgur.com/rMetuYd.png",players:[{uid:1,id:"GK",team:"red",x:.1,y:.5,size:29},{uid:2,id:"VL",team:"red",x:.3,y:.3,size:29},{uid:3,id:"MC",team:"red",x:.3,y:.7,size:29},{uid:4,id:"PV",team:"red",x:.45,y:.5,size:29},{uid:5,id:"GK",team:"blue",x:.9,y:.5,size:29},{uid:6,id:"VL",team:"blue",x:.7,y:.3,size:29},{uid:7,id:"MC",team:"blue",x:.7,y:.7,size:29},{uid:8,id:"PV",team:"blue",x:.55,y:.5,size:29},{uid:10,id:"",team:"ball",x:.5,y:.5,size:12}]}},"7x7":{futsal:{backgroundImage:"https://i.imgur.com/n56z593.png",players:[{uid:1,id:"GK",team:"red",x:.05,y:.5,size:25},{uid:2,id:"LD",team:"red",x:.2,y:.2,size:25},{uid:3,id:"PD",team:"red",x:.35,y:.2,size:25},{uid:4,id:"MC",team:"red",x:.15,y:.6,size:25},{uid:5,id:"LE",team:"red",x:.2,y:.8,size:25},{uid:6,id:"PV",team:"red",x:.35,y:.5,size:25},{uid:7,id:"PE",team:"red",x:.35,y:.8,size:25},{uid:8,id:"GK",team:"blue",x:.95,y:.5,size:25},{uid:9,id:"LD",team:"blue",x:.8,y:.2,size:25},{uid:10,id:"PD",team:"blue",x:.65,y:.2,size:25},{uid:11,id:"MC",team:"blue",x:.85,y:.6,size:25},{uid:12,id:"LE",team:"blue",x:.8,y:.8,size:25},{uid:13,id:"PV",team:"blue",x:.65,y:.5,size:25},{uid:14,id:"PE",team:"blue",x:.65,y:.8,size:25},{uid:15,id:"",team:"ball",x:.5,y:.5,size:10}]}},"11x11":{futsal:{backgroundImage:"https://i.imgur.com/TMJUugB.png",players:[{uid:1,id:"GK",team:"red",x:.05,y:.5,size:22},{uid:2,id:"LE",team:"red",x:.2,y:.15,size:22},{uid:3,id:"ZAG",team:"red",x:.2,y:.35,size:22},{uid:4,id:"ZAG",team:"red",x:.2,y:.65,size:22},{uid:5,id:"LD",team:"red",x:.2,y:.85,size:22},{uid:6,id:"VOL",team:"red",x:.35,y:.25,size:22},{uid:7,id:"MC",team:"red",x:.35,y:.5,size:22},{uid:8,id:"MC",team:"red",x:.35,y:.75,size:22},{uid:9,id:"MEI",team:"red",x:.48,y:.47,size:22},{uid:10,id:"ATA",team:"red",x:.65,y:.35,size:22},{uid:11,id:"ATA",team:"red",x:.65,y:.65,size:22},{uid:12,id:"GK",team:"blue",x:.95,y:.5,size:22},{uid:13,id:"LE",team:"blue",x:.8,y:.15,size:22},{uid:14,id:"ZAG",team:"blue",x:.8,y:.35,size:22},{uid:15,id:"ZAG",team:"blue",x:.8,y:.65,size:22},{uid:16,id:"LD",team:"blue",x:.8,y:.85,size:22},{uid:17,id:"VOL",team:"blue",x:.65,y:.25,size:22},{uid:18,id:"MC",team:"blue",x:.65,y:.5,size:22},{uid:19,id:"MC",team:"blue",x:.65,y:.75,size:22},{uid:20,id:"MEI",team:"blue",x:.52,y:.53,size:22},{uid:21,id:"ATA",team:"blue",x:.35,y:.35,size:22},{uid:22,id:"ATA",team:"blue",x:.35,y:.65,size:22},{uid:23,id:"",team:"ball",x:.5,y:.5,size:10}]},realsoccer:{backgroundImage:"https://i.imgur.com/VJ0hQX5.png",players:[{uid:1,id:"GK",team:"red",x:.05,y:.5,size:22},{uid:2,id:"LE",team:"red",x:.18,y:.15,size:22},{uid:3,id:"ZAG",team:"red",x:.18,y:.35,size:22},{uid:4,id:"ZAG",team:"red",x:.18,y:.65,size:22},{uid:5,id:"LD",team:"red",x:.18,y:.85,size:22},{uid:6,id:"VOL",team:"red",x:.32,y:.5,size:22},{uid:7,id:"MC",team:"red",x:.42,y:.3,size:22},{uid:8,id:"MC",team:"red",x:.42,y:.7,size:22},{uid:9,id:"PE",team:"red",x:.58,y:.2,size:22},{uid:10,id:"ATA",team:"red",x:.65,y:.5,size:22},{uid:11,id:"PD",team:"red",x:.58,y:.8,size:22},{uid:12,id:"GK",team:"blue",x:.95,y:.5,size:22},{uid:13,id:"LE",team:"blue",x:.82,y:.15,size:22},{uid:14,id:"ZAG",team:"blue",x:.82,y:.35,size:22},{uid:15,id:"ZAG",team:"blue",x:.82,y:.65,size:22},{uid:16,id:"LD",team:"blue",x:.82,y:.85,size:22},{uid:17,id:"VOL",team:"blue",x:.68,y:.5,size:22},{uid:18,id:"MC",team:"blue",x:.58,y:.3,size:22},{uid:19,id:"MC",team:"blue",x:.58,y:.7,size:22},{uid:20,id:"PE",team:"blue",x:.42,y:.2,size:22},{uid:21,id:"ATA",team:"blue",x:.35,y:.5,size:22},{uid:22,id:"PD",team:"blue",x:.42,y:.8,size:22},{uid:23,id:"",team:"ball",x:.5,y:.5,size:8}]}}};class ee{constructor(){this.visits=0,this.initCounter()}async initCounter(){try{let e=0;try{const m=await fetch("https://api.countapi.xyz/hit/tacticalboard-haxball/global-visits");if(m.ok){e=(await m.json()).value,this.visits=e,this.updateViewerDisplay();return}}catch{console.log("CountAPI falhou, tentando próxima...")}try{const m=await fetch("https://visitor-badge.laobi.icu/badge?page_id=tacticalboard.haxball.global");if(m.ok){const z=(await m.text()).match(/(\d+)/);if(z){e=parseInt(z[1]),this.visits=e,this.updateViewerDisplay();return}}}catch{console.log("VisitorBadge falhou, tentando próxima...")}const i=Date.now(),r=Math.floor(i/(1e3*60*60*24)),n=r*50,s=Math.floor(Math.sin(r)*1e3)+1e3;e=n+s;const d=navigator.userAgent,p=`${screen.width}x${screen.height}`,c=this.simpleHash(d+p+new Date().toDateString());localStorage.getItem("haxball_visited_today_"+c)||(e+=1,localStorage.setItem("haxball_visited_today_"+c,"true"),this.cleanOldVisits()),this.visits=e,this.updateViewerDisplay()}catch(e){console.error("Erro no contador:",e),this.visits=15847,this.updateViewerDisplay()}}simpleHash(e){let i=0;for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);i=(i<<5)-i+n,i=i&i}return Math.abs(i)}cleanOldVisits(){Object.keys(localStorage).forEach(i=>{if(i.startsWith("haxball_visited_today_")){const r=new Date().toDateString();localStorage.getItem("haxball_cleaned_"+r)||(localStorage.removeItem(i),localStorage.setItem("haxball_cleaned_"+r,"true"))}})}updateViewerDisplay(){const e=document.getElementById("viewerCount");if(e){const i=u[l]?.viewerCount||"Visitantes";e.textContent=`${i}: ${this.visits}`}}async trackVisit(){}async trackDownload(){}async trackDraw(){}async trackLanguageChange(){this.updateViewerDisplay()}async trackDiscordClick(){}async trackConfigChange(){}}const E=new ee,w=document.getElementById("board"),o=document.getElementById("drawLayer"),D=document.getElementById("players");(!w||!o||!D)&&console.error("Elementos HTML não encontrados!",{board:w,draw:o,playersLayer:D});const a=o?.getContext("2d");let f="line",M=!1,B=!1,C=null,g=null,h=[];const te=10;let l="pt",b="3x3",v="futsal",V=[],R=!1,S=null,G=!0,Y="#B917FF",H="#ff0000",K="#ff4444",$="#4444ff",A=[...L[b][v].players];const u={pt:{drawOnBtn:"Ativar Desenho",drawOffBtn:"Desativar Desenho",eraseBtn:"Borracha",clearBtn:"Limpar",colorLabel:"Cor:",downloadBtn:"Baixar PNG",freeBtn:"Livre",lineBtn:"Linha",squareBtn:"Quadrado",triangleBtn:"Triângulo",circleBtn:"Círculo",arrowBtn:"Seta",strokeSizeLabel:"Tamanho do Traço:",eraserSizeLabel:"Tamanho da Borracha:",discordMessage:"ENTRE AGORA MESMO EM NOSSO DISCORD PARA PARTICIPAR DOS EVENTOS.",creditsLabel:"Feito por:",helpProject:"Ajude o projeto",teamSizeLabel:"Tamanho do Time:",mapTypeLabel:"Tipo de Mapa:",currentModeLabel:"— 3x3 Futsal",comingSoon:"Em breve!",primaryColorLabel:"Cor Primária:",secondaryColorLabel:"Cor Secundária:",tipsButton:"💡 Dicas",clearShadowsBtn:"Limpar Shadows",viewerCount:"Visitantes",toggleShadowBtn:"Ativar Sombra"},en:{drawOnBtn:"Activate Draw",drawOffBtn:"Deactivate Draw",eraseBtn:"Eraser",clearBtn:"Clear",colorLabel:"Color:",downloadBtn:"Download PNG",freeBtn:"Free",lineBtn:"Line",squareBtn:"Square",triangleBtn:"Triangle",circleBtn:"Circle",arrowBtn:"Arrow",strokeSizeLabel:"Stroke Size:",eraserSizeLabel:"Eraser Size:",discordMessage:"JOIN OUR DISCORD NOW TO PARTICIPATE IN EVENTS.",creditsLabel:"Made by:",helpProject:"Help the project",teamSizeLabel:"Team Size:",mapTypeLabel:"Map Type:",currentModeLabel:"— 3x3 Futsal",comingSoon:"Coming soon!",primaryColorLabel:"Primary Color:",secondaryColorLabel:"Secondary Color:",tipsButton:"💡 Tips",clearShadowsBtn:"Clear Shadows",viewerCount:"Visitors",toggleShadowBtn:"Toggle Shadow"},tr:{drawOnBtn:"Çizimi Etkinleştir",drawOffBtn:"Çizimi Devre Dışı Bırak",eraseBtn:"Silgi",clearBtn:"Temizle",colorLabel:"Renk:",downloadBtn:"PNG İndir",freeBtn:"Serbest",lineBtn:"Çizgi",squareBtn:"Kare",triangleBtn:"Üçgen",circleBtn:"Çember",arrowBtn:"Ok",strokeSizeLabel:"Çizgi Kalınlığı:",eraserSizeLabel:"Silgi Boyutu:",discordMessage:"ETKİNLİKLERE KATILMAK İÇİN DISCORD'UMUZA HEMEN KATILIN.",creditsLabel:"Yapılan:",helpProject:"Projeye yardım et",teamSizeLabel:"Takım Boyutu:",mapTypeLabel:"Harita Tipi:",currentModeLabel:"— 3x3 Futsal",comingSoon:"Yakında!",primaryColorLabel:"Birincil Renk:",secondaryColorLabel:"İkincil Renk:",tipsButton:"💡 İpuçları",clearShadowsBtn:"Gölgeleri Temizle",viewerCount:"Ziyaretçiler",toggleShadowBtn:"Gölge Aç/Kapat"},es:{drawOnBtn:"Activar Dibujo",drawOffBtn:"Desactivar Dibujo",eraseBtn:"Goma",clearBtn:"Limpiar",colorLabel:"Color:",downloadBtn:"Descargar PNG",freeBtn:"Libre",lineBtn:"Línea",squareBtn:"Cuadrado",triangleBtn:"Triángulo",circleBtn:"Círculo",arrowBtn:"Flecha",strokeSizeLabel:"Grosor del Trazo:",eraserSizeLabel:"Tamaño de la Goma:",discordMessage:"ÚNETE A NUESTRO DISCORD AHORA PARA PARTICIPAR EN LOS EVENTOS.",creditsLabel:"Hecho por:",helpProject:"Ayuda al proyecto",teamSizeLabel:"Tamaño del Equipo:",mapTypeLabel:"Tipo de Mapa:",currentModeLabel:"— 3x3 Futsal",comingSoon:"¡Próximamente!",primaryColorLabel:"Color Primario:",secondaryColorLabel:"Color Secundario:",tipsButton:"💡 Consejos",clearShadowsBtn:"Limpiar Sombras",viewerCount:"Visitantes",toggleShadowBtn:"Activar Sombra"}};function X(){const t=b,e=v.charAt(0).toUpperCase()+v.slice(1);document.getElementById("currentModeLabel").textContent=`— ${t} ${e}`}function W(){const t=document.getElementById("teamSizeSelect"),e=document.getElementById("mapTypeSelect");t.innerHTML="",e.innerHTML="",Object.keys(L).forEach(i=>{const r=document.createElement("option");r.value=i,r.textContent=i,i===b&&(r.selected=!0),t.appendChild(r)}),L[b]&&Object.keys(L[b]).forEach(i=>{const r=document.createElement("option");r.value=i,r.textContent=i.charAt(0).toUpperCase()+i.slice(1),i===v&&(r.selected=!0),e.appendChild(r)})}function P(){const t={drawOnBtn:u[l].drawOnBtn,drawOffBtn:u[l].drawOffBtn,eraseBtn:u[l].eraseBtn,clearBtn:u[l].clearBtn,downloadBtn:u[l].downloadBtn,freeBtn:u[l].freeBtn,lineBtn:u[l].lineBtn,squareBtn:u[l].squareBtn,triangleBtn:u[l].triangleBtn,circleBtn:u[l].circleBtn,arrowBtn:u[l].arrowBtn,tipsBtn:u[l].tipsButton,clearShadowsBtn:u[l].clearShadowsBtn,toggleShadowBtn:G?l==="pt"?"Desativar Sombra":l==="en"?"Disable Shadow":l==="tr"?"Gölgeyi Kapat":"Desactivar Sombra":u[l].toggleShadowBtn};Object.keys(t).forEach(r=>{const n=document.getElementById(r);n?n.textContent=t[r]:console.warn(`Elemento não encontrado: ${r}`)});const e={strokeSizeLabel:u[l].strokeSizeLabel,eraserSizeLabel:u[l].eraserSizeLabel,primaryColorLabel:u[l].primaryColorLabel,secondaryColorLabel:u[l].secondaryColorLabel,creditsLabel:u[l].creditsLabel,helpProjectLabel:u[l].helpProject,teamSizeLabel:u[l].teamSizeLabel,mapTypeLabel:u[l].mapTypeLabel};Object.keys(e).forEach(r=>{const n=document.getElementById(r);n&&(n.textContent=e[r])});const i=document.querySelector(".discord-message a");i&&(i.textContent=u[l].discordMessage),document.querySelectorAll(".language-selector img").forEach(r=>{r.classList.remove("active")}),document.getElementById(`flag-${l}`).classList.add("active"),E.updateViewerDisplay(),X()}document.getElementById("flag-pt").addEventListener("click",()=>{l="pt",P(),E.trackLanguageChange("pt")});document.getElementById("flag-en").addEventListener("click",()=>{l="en",P(),E.trackLanguageChange("en")});document.getElementById("flag-tr").addEventListener("click",()=>{l="tr",P(),E.trackLanguageChange("tr")});document.getElementById("flag-es").addEventListener("click",()=>{l="es",P(),E.trackLanguageChange("es")});document.getElementById("teamSizeSelect").addEventListener("change",t=>{const e=t.target.value;if(L[e]){const i=Object.keys(L[e]),r=i.includes(v)?v:i[0];Z(e,r),E.trackConfigChange("team_size",e)}else t.target.value=b,alert(u[l].comingSoon)});document.getElementById("mapTypeSelect").addEventListener("change",t=>{const e=t.target.value;L[b]&&L[b][e]?(Z(b,e),E.trackConfigChange("map_type",e)):(t.target.value=v,alert(u[l].comingSoon))});function Z(t,e){b=t,v=e;const i=document.getElementById("formationSelectors");t==="11x11"?i.style.display="flex":i.style.display="none",D.innerHTML="";let r=L[t][e];if(A=[...r.players],t==="11x11"){const n=document.getElementById("redFormationSelect").value,s=document.getElementById("blueFormationSelect").value;let d=N[n].red.map((m,x)=>({uid:x+1,id:m.id,team:"red",x:m.x,y:m.y,size:22})),p=N[s].blue.map((m,x)=>({uid:x+12,id:m.id,team:"blue",x:m.x,y:m.y,size:22})),c={uid:23,id:"",team:"ball",x:.5,y:.5,size:10};A=[...d,...p,c]}w.style.backgroundImage=`url('${r.backgroundImage}')`,A.forEach(n=>{const s=document.createElement("div");s.className=`player ${n.team}`,s.textContent=n.id,s.dataset.uid=n.uid,s.style.setProperty("--size",`${n.size}px`),D.appendChild(s),n.el=s}),F(),a.clearRect(0,0,o.width,o.height),h=[],V=[],W(),X()}document.querySelector(".discord-message a").addEventListener("click",()=>{E.trackDiscordClick()});function q(){h.length>=te&&h.shift(),h.push(o.toDataURL())}function ie(){if(h.length>0)if(h.pop(),h.length>0){const t=new Image;t.onload=()=>{a.clearRect(0,0,o.width,o.height),a.drawImage(t,0,0),T()},t.src=h[h.length-1]}else a.clearRect(0,0,o.width,o.height),T()}function j(){if(!o||!w||!a){console.error("Canvas ou elementos não encontrados para resize");return}if(o.width=w.clientWidth,o.height=w.clientHeight,h.length>0){const t=new Image;t.onload=()=>{a.drawImage(t,0,0),T()},t.src=h[h.length-1]}else T()}window.addEventListener("resize",j);j();A.forEach(t=>{const e=document.createElement("div");e.className=`player ${t.team}`,e.textContent=t.id,e.dataset.uid=t.uid,e.style.setProperty("--size",`${t.size}px`),D.appendChild(e),t.el=e});function F(){const t=w.getBoundingClientRect();A.forEach(e=>{const i=e.size||29;e.el.style.left=e.x*t.width-i/2+"px",e.el.style.top=e.y*t.height-i/2+"px"})}F();window.addEventListener("resize",F);let y=null;w.addEventListener("pointerdown",t=>{const e=t.target.closest(".player");if(!e)return;const i=w.getBoundingClientRect(),r=e.dataset.uid,n=A.find(s=>s.uid==r);if(n){if(n.size,t.button===2){t.preventDefault(),G&&(R=!0,S={x:n.x,y:n.y,player:n}),y={p:n,offsetX:t.clientX-i.left-n.x*i.width,offsetY:t.clientY-i.top-n.y*i.height},e.setPointerCapture(t.pointerId);return}y={p:n,offsetX:t.clientX-i.left-n.x*i.width,offsetY:t.clientY-i.top-n.y*i.height},e.setPointerCapture(t.pointerId)}});window.addEventListener("pointermove",t=>{if(!y)return;const e=w.getBoundingClientRect(),i=y.p.size||29;y.p.x=(t.clientX-e.left-y.offsetX)/e.width,y.p.y=(t.clientY-e.top-y.offsetY)/e.height;const r=i/2/e.width,n=1-i/2/e.width,s=i/2/e.height,d=1-i/2/e.height;if(y.p.x=Math.max(r,Math.min(y.p.x,n)),y.p.y=Math.max(s,Math.min(y.p.y,d)),F(),R&&S){if(a.clearRect(0,0,o.width,o.height),h.length>0){const O=new Image;O.src=h[h.length-1],a.drawImage(O,0,0)}T();const p=S.x*e.width,c=S.y*e.height,m=y.p.x*e.width,x=y.p.y*e.height;a.strokeStyle="#ffff00",a.lineWidth=2,a.setLineDash([5,5]),a.beginPath(),a.moveTo(p,c),a.lineTo(m,x),a.stroke(),a.setLineDash([]);const z=y.p.size||29;a.save(),a.globalAlpha=.5,a.beginPath(),a.arc(p,c,z/2-2,0,Math.PI*2),a.fillStyle=y.p.team==="red"?"#e53935":y.p.team==="blue"?"#1e88e5":"#B917FF",a.fill(),a.strokeStyle="black",a.lineWidth=2,a.stroke(),y.p.id&&(a.font=`bold ${Math.max(10,z*.4)}px Arial, sans-serif`,a.fillStyle="white",a.textAlign="center",a.textBaseline="middle",a.fillText(y.p.id,p,c)),a.restore()}});window.addEventListener("pointerup",t=>{if(R&&S){if(V.push({startX:S.x,startY:S.y,endX:y.p.x,endY:y.p.y,playerId:y.p.uid,playerSize:y.p.size||29,playerTeam:y.p.team,playerText:y.p.id}),a.clearRect(0,0,o.width,o.height),h.length>0){const e=new Image;e.onload=()=>{a.drawImage(e,0,0),T(),q()},e.src=h[h.length-1]}else T(),q();R=!1,S=null}y=null});function k(t){if(!o)return{x:0,y:0};const e=o.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}function T(){if(!a||!w)return;const t=w.getBoundingClientRect();V.forEach(e=>{const i=e.startX*t.width,r=e.startY*t.height,n=e.endX*t.width,s=e.endY*t.height,d=e.playerTeam==="red"?K:e.playerTeam==="blue"?$:"#ffff00";a.strokeStyle=d,a.lineWidth=2,a.setLineDash([5,5]),a.beginPath(),a.moveTo(i,r),a.lineTo(n,s),a.stroke(),a.setLineDash([]);const p=e.playerSize;a.save(),a.globalAlpha=.5,a.beginPath(),a.arc(n,s,p/2-2,0,Math.PI*2);const c=e.playerTeam==="red"?K:e.playerTeam==="blue"?$:"#B917FF";a.fillStyle=c,a.fill(),a.strokeStyle="black",a.lineWidth=2,a.stroke(),e.playerText&&(a.font=`bold ${Math.max(10,p*.4)}px Arial, sans-serif`,a.fillStyle="white",a.textAlign="center",a.textBaseline="middle",a.fillText(e.playerText,n,s)),a.restore()})}function _(t){const e=k(t);if(a.clearRect(0,0,o.width,o.height),h.length>0){const r=new Image;r.src=h[h.length-1],a.drawImage(r,0,0)}const i=t.button===2?H:Y;if(a.strokeStyle=i,a.lineWidth=document.getElementById("sizePicker").value,a.lineCap="round",a.beginPath(),f==="line")a.moveTo(g.x,g.y),a.lineTo(e.x,e.y),a.stroke();else if(f==="square"){const r=e.x-g.x,n=e.y-g.y;a.strokeRect(g.x,g.y,r,n)}else if(f==="triangle")a.moveTo(g.x,g.y),a.lineTo(e.x,e.y),a.lineTo(g.x+(e.x-g.x)/2,g.y),a.closePath(),a.stroke();else if(f==="circle"){const r=e.x-g.x,n=e.y-g.y,s=Math.sqrt(r*r+n*n)/2;a.arc(g.x+r/2,g.y+n/2,s,0,2*Math.PI),a.stroke()}else if(f==="arrow"){const n=Math.atan2(e.y-g.y,e.x-g.x);a.moveTo(g.x,g.y),a.lineTo(e.x,e.y),a.stroke(),a.beginPath(),a.moveTo(e.x,e.y),a.lineTo(e.x-15*Math.cos(n-Math.PI/6),e.y-15*Math.sin(n-Math.PI/6)),a.lineTo(e.x-15*Math.cos(n+Math.PI/6),e.y-15*Math.sin(n+Math.PI/6)),a.closePath(),a.fillStyle=a.strokeStyle,a.fill()}}function ae(t){if(B){M=!0,C=k(t);return}if(f!==null)if(M=!0,f==="free"){C=k(t);const e=t.button===2?H:Y;a.strokeStyle=e,a.lineWidth=document.getElementById("sizePicker").value,a.lineCap="round",a.beginPath(),a.moveTo(C.x,C.y)}else g=k(t),C=k(t)}function ne(t){if(M)if(B){const e=k(t);a.lineWidth=document.getElementById("eraserSizePicker").value,a.lineCap="round",a.globalCompositeOperation="destination-out",a.beginPath(),a.moveTo(C.x,C.y),a.lineTo(e.x,e.y),a.stroke(),C=e}else if(f==="free"){const e=k(t);a.globalCompositeOperation="source-over",a.lineTo(e.x,e.y),a.stroke(),C=e}else _(t)}function J(t){M&&(B||(f==="free"||_(t),T(),q()),M=!1,C=null,g=null,a.globalCompositeOperation="source-over")}o.addEventListener("mousedown",ae);o.addEventListener("mousemove",ne);window.addEventListener("mouseup",J);o.addEventListener("mouseleave",J);o.addEventListener("contextmenu",t=>t.preventDefault());o.addEventListener("contextmenu",t=>t.preventDefault());w.addEventListener("contextmenu",t=>{t.target.closest(".player")&&t.preventDefault()});window.addEventListener("keydown",t=>{t.ctrlKey&&t.key==="z"&&(t.preventDefault(),ie())});function I(t){document.querySelectorAll(".shape-menu button, #drawOnBtn, #eraseBtn, #drawOffBtn").forEach(e=>{e.classList.remove("active")}),t&&document.getElementById(t).classList.add("active")}document.getElementById("redFormationSelect").addEventListener("change",()=>{b==="11x11"&&Z(b,v)});document.getElementById("blueFormationSelect").addEventListener("change",()=>{b==="11x11"&&Z(b,v)});class re{constructor(){this.currentTab="tactical",this.initTabs()}initTabs(){const e=document.querySelectorAll(".tab");document.querySelectorAll(".tab-content"),e.forEach(i=>{i.addEventListener("click",()=>{const r=i.dataset.tab;this.switchTab(r)})})}switchTab(e){document.querySelectorAll(".tab").forEach(i=>i.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(i=>i.classList.remove("active")),document.querySelector(`[data-tab="${e}"]`).classList.add("active"),document.getElementById(`${e}-tab`).classList.add("active"),this.currentTab=e,e==="replay"&&!this.replayInitialized&&(this.initReplayPlayer(),this.replayInitialized=!0)}initReplayPlayer(){new se().init()}}class se{constructor(){this.replay=null,this.isPlaying=!1,this.currentTime=0,this.duration=0,this.players=[],this.canvas=null,this.ctx=null,this.drawCanvas=null,this.drawCtx=null,this.animationFrame=null}init(){this.setupCanvas(),this.setupEventListeners()}setupCanvas(){this.canvas=document.getElementById("replayCanvas"),this.ctx=this.canvas?.getContext("2d"),this.drawCanvas=document.getElementById("replayDrawLayer"),this.drawCtx=this.drawCanvas?.getContext("2d"),this.canvas&&this.drawCanvas&&(this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()))}resizeCanvas(){const i=this.canvas.parentElement.getBoundingClientRect();[this.canvas,this.drawCanvas].forEach(r=>{r.width=i.width,r.height=i.height})}setupEventListeners(){const e=document.getElementById("hbr2FileInput"),i=document.getElementById("selectFileBtn"),r=document.getElementById("uploadArea");i?.addEventListener("click",()=>e?.click()),e?.addEventListener("change",s=>{s.target.files[0]&&this.loadReplay(s.target.files[0])}),r?.addEventListener("dragover",s=>{s.preventDefault(),r.classList.add("dragover")}),r?.addEventListener("dragleave",()=>{r.classList.remove("dragover")}),r?.addEventListener("drop",s=>{s.preventDefault(),r.classList.remove("dragover"),s.dataTransfer.files[0]&&this.loadReplay(s.dataTransfer.files[0])}),document.getElementById("playPauseBtn")?.addEventListener("click",()=>this.togglePlayPause()),document.getElementById("stopBtn")?.addEventListener("click",()=>this.stop()),document.getElementById("timelineSlider")?.addEventListener("input",s=>{this.seekTo(parseFloat(s.target.value))}),document.getElementById("replayDrawBtn")?.addEventListener("click",()=>this.setDrawMode("draw")),document.getElementById("replayEraseBtn")?.addEventListener("click",()=>this.setDrawMode("erase")),document.getElementById("replayClearBtn")?.addEventListener("click",()=>this.clearDrawings()),document.getElementById("newReplayBtn")?.addEventListener("click",()=>this.newReplay())}newReplay(){this.stop(),this.replay=null,this.currentTime=0,this.duration=0,this.clearDrawings(),document.getElementById("uploadArea").style.display="block",document.getElementById("replayPlayer").style.display="none",document.getElementById("fileInput").value="";const e=document.getElementById("timelineEvents");e&&(e.innerHTML="")}async loadReplay(e){try{console.log("Carregando arquivo:",e.name);const i=await e.arrayBuffer();this.replay=await this.parseHBR2(i),this.replay&&(console.log("Replay carregado com sucesso:",this.replay),this.displayReplayInfo(),this.showPlayer(),this.duration=this.replay.duration||300,this.currentTime=0,this.updateUI(),this.render())}catch(i){console.error("Erro ao carregar replay:",i),this.createDemoReplay()}}createDemoReplay(){this.replay={version:1,duration:300,players:[{id:1,name:"Player 1",team:1,color:16729156},{id:2,name:"Player 2",team:1,color:16729156},{id:3,name:"Player 3",team:1,color:16729156},{id:4,name:"Player 4",team:2,color:4474111},{id:5,name:"Player 5",team:2,color:4474111},{id:6,name:"Player 6",team:2,color:4474111}],events:[{type:"goal",time:45.5,player:"Player 1",team:1},{type:"goal",time:120.3,player:"Player 4",team:2},{type:"goal",time:180.7,player:"Player 2",team:1},{type:"goal",time:250.1,player:"Player 5",team:2}],stadium:{name:"Clássico",width:800,height:400}},console.log("Replay demo criado:",this.replay),this.displayReplayInfo(),this.showPlayer(),this.duration=this.replay.duration,this.currentTime=0,this.updateUI(),this.render()}async parseHBR2(e){try{console.log("Tentando fazer parse do HBR2, tamanho:",e.byteLength);const i=new DataView(e),r=new TextDecoder;if(e.byteLength<16)throw new Error("Arquivo muito pequeno para ser um HBR2 válido");let n=0;const s=i.getUint32(n,!0);n+=4,console.log("Versão detectada:",s);const d={version:s,duration:0,players:[],events:[],frames:[],stadium:null};return console.log("Estrutura básica do HBR2 detectada"),d}catch(i){throw console.error("Erro no parser HBR2:",i),i}}displayReplayInfo(){if(!this.replay)return;const e=this.replay.players?this.replay.players.length:0,i=this.replay.events?this.replay.events.filter(r=>r.type==="goal").length:0;document.getElementById("replayTitle").textContent=`Replay Carregado - ${i} gols`,document.getElementById("replayDuration").textContent=`Duração: ${this.formatTime(this.replay.duration)}`,document.getElementById("replayPlayers").textContent=`Jogadores: ${e}`,document.getElementById("replayMap").textContent=`Mapa: ${this.replay.stadium?.name||"Clássico"}`}showPlayer(){document.getElementById("uploadArea").style.display="none",document.getElementById("replayPlayer").style.display="block"}togglePlayPause(){this.isPlaying=!this.isPlaying;const e=document.getElementById("playPauseBtn");this.isPlaying?(e.textContent="⏸️ Pause",this.play()):(e.textContent="▶️ Play",this.pause())}play(){if(!this.replay)return;const e=()=>{this.isPlaying&&this.currentTime<this.duration?(this.currentTime+=1/60,this.render(),this.updateUI(),this.animationFrame=requestAnimationFrame(e)):this.currentTime>=this.duration&&this.stop()};e()}pause(){this.animationFrame&&cancelAnimationFrame(this.animationFrame)}stop(){this.isPlaying=!1,this.currentTime=0,this.pause(),document.getElementById("playPauseBtn").textContent="▶️ Play",this.updateUI()}seekTo(e){this.currentTime=e/100*this.duration,this.render(),this.updateUI()}render(){!this.ctx||!this.replay||(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawField(),this.drawPlayers(),this.drawTimelineEvents())}drawField(){const e=this.canvas.width,i=this.canvas.height;this.ctx.fillStyle="#4a7c59",this.ctx.fillRect(0,0,e,i),this.ctx.strokeStyle="white",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.rect(40,40,e-80,i-80),this.ctx.moveTo(e/2,40),this.ctx.lineTo(e/2,i-40),this.ctx.arc(e/2,i/2,60,0,Math.PI*2),this.ctx.moveTo(e/2+60,i/2);const r=120,n=80,s=(i-n)/2;this.ctx.rect(40,s,r,n),this.ctx.rect(e-40-r,s,r,n);const d=8,p=40,c=(i-p)/2;this.ctx.rect(40-d,c,d,p),this.ctx.rect(e-40,c,d,p),this.ctx.stroke()}drawPlayers(){if(!this.replay.players)return;this.replay.players.forEach((r,n)=>{const s=100+n%3*200,d=100+Math.floor(n/3)*100,p=s+Math.sin(this.currentTime*.5+n)*50,c=d+Math.cos(this.currentTime*.3+n)*30;this.ctx.beginPath(),this.ctx.arc(p,c,18,0,Math.PI*2),this.ctx.fillStyle=r.team===1?"#ff4444":"#4444ff",this.ctx.fill(),this.ctx.strokeStyle="black",this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.fillStyle="white",this.ctx.font="bold 11px Arial",this.ctx.textAlign="center",this.ctx.fillText(r.name,p,c+3)});const e=this.canvas.width/2+Math.sin(this.currentTime)*100,i=this.canvas.height/2+Math.cos(this.currentTime*1.2)*50;this.ctx.beginPath(),this.ctx.arc(e,i,8,0,Math.PI*2),this.ctx.fillStyle="#ffffff",this.ctx.fill(),this.ctx.strokeStyle="black",this.ctx.lineWidth=2,this.ctx.stroke()}drawTimelineEvents(){if(!this.replay.events)return;const e=document.getElementById("timelineEvents");e&&(e.innerHTML="",this.replay.events.forEach(i=>{const r=document.createElement("div");r.className=`timeline-event ${i.type}`,r.style.left=`${i.time/this.duration*100}%`,r.title=`${i.type.toUpperCase()}: ${i.player} (${this.formatTime(i.time)})`,r.addEventListener("click",()=>{this.currentTime=i.time,this.updateUI(),this.render()}),e.appendChild(r)}))}updateUI(){const e=document.getElementById("timelineSlider"),i=document.getElementById("timeDisplay");e&&(e.value=this.currentTime/this.duration*100||0),i&&(i.textContent=`${this.formatTime(this.currentTime)} / ${this.formatTime(this.duration)}`)}formatTime(e){const i=Math.floor(e/60),r=Math.floor(e%60);return`${i.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`}setDrawMode(e){this.drawMode=e,document.querySelectorAll(".replay-toolbar button").forEach(i=>i.classList.remove("active")),e==="draw"?(document.getElementById("replayDrawBtn").classList.add("active"),this.drawCanvas.style.cursor="crosshair"):e==="erase"?(document.getElementById("replayEraseBtn").classList.add("active"),this.drawCanvas.style.cursor="grab"):this.drawCanvas.style.cursor="default",e==="draw"&&this.setupDrawingEvents()}setupDrawingEvents(){let e=!1,i=0,r=0;this.drawCanvas.onmousedown=n=>{e=!0,[i,r]=[n.offsetX,n.offsetY],n.button===0?this.drawCtx.strokeStyle=document.getElementById("leftClickColor").value:n.button===2&&(this.drawCtx.strokeStyle=document.getElementById("rightClickColor").value,n.preventDefault()),this.drawCtx.lineWidth=document.getElementById("brushSize").value,this.drawCtx.lineCap="round"},this.drawCanvas.onmousemove=n=>{e&&(this.drawCtx.beginPath(),this.drawCtx.moveTo(i,r),this.drawCtx.lineTo(n.offsetX,n.offsetY),this.drawCtx.stroke(),[i,r]=[n.offsetX,n.offsetY])},this.drawCanvas.onmouseup=()=>{e=!1},this.drawCanvas.oncontextmenu=n=>{n.preventDefault()}}clearDrawings(){this.drawCtx&&this.drawCtx.clearRect(0,0,this.drawCanvas.width,this.drawCanvas.height)}}document.addEventListener("DOMContentLoaded",()=>{new re});document.getElementById("drawOnBtn").onclick=()=>{B=!1,f="line",o.style.pointerEvents="auto",I("drawOnBtn"),document.getElementById("lineBtn").classList.add("active"),E.trackDraw()};document.getElementById("drawOffBtn").onclick=()=>{B=!1,f=null,o.style.pointerEvents="none",I("drawOffBtn")};document.getElementById("eraseBtn").onclick=()=>{B=!0,f=null,o.style.pointerEvents="auto",I("eraseBtn")};document.getElementById("clearBtn").onclick=()=>{a.clearRect(0,0,o.width,o.height),h=[],V=[]};document.getElementById("freeBtn").onclick=()=>{B=!1,f="free",o.style.pointerEvents="auto",I("freeBtn")};document.getElementById("lineBtn").onclick=()=>{B=!1,f="line",o.style.pointerEvents="auto",I("lineBtn")};document.getElementById("squareBtn").onclick=()=>{B=!1,f="square",o.style.pointerEvents="auto",I("squareBtn")};document.getElementById("triangleBtn").onclick=()=>{B=!1,f="triangle",o.style.pointerEvents="auto",I("triangleBtn")};document.getElementById("circleBtn").onclick=()=>{B=!1,f="circle",o.style.pointerEvents="auto",I("circleBtn")};document.getElementById("arrowBtn").onclick=()=>{B=!1,f="arrow",o.style.pointerEvents="auto",I("arrowBtn")};document.getElementById("primaryColorPicker").addEventListener("change",t=>{Y=t.target.value});document.getElementById("secondaryColorPicker").addEventListener("change",t=>{H=t.target.value});document.getElementById("redShadowColorPicker").addEventListener("change",t=>{K=t.target.value});document.getElementById("blueShadowColorPicker").addEventListener("change",t=>{$=t.target.value});document.getElementById("tipsBtn").onclick=()=>{alert({pt:`💡 DICAS:

• Ctrl+Z: Desfazer última ação
• Botão Esquerdo: Desenhar com cor primária
• Botão Direito: Desenhar com cor secundária
• Ative sombra e segure o jogador com botão direito e arraste para criar um rastro de movimento
• Use 'Limpar Shadows' para remover todas as setas de movimento`,en:`💡 TIPS:

• Ctrl+Z: Undo last action
• Left Click: Draw with primary color
• Right Click: Draw with secondary color
• Activate shadow and hold the player with right mouse button and drag to create a movement trail
• Use 'Clear Shadows' to remove all movement arrows`,tr:`💡 İPUÇLARI:

• Ctrl+Z: Son işlemi geri al
• Sol Tık: Birincil renkle çiz
• Sağ Tık: İkincil renkle çiz
• Gölgeyi etkinleştirip oyuncuya sağ tıkla ve sürükle, hareket izi oluştur
• Tüm hareket oklarını kaldırmak için 'Gölgeleri Temizle' kullanın`,es:`💡 CONSEJOS:

• Ctrl+Z: Deshacer última acción
• Clic Izquierdo: Dibujar con color primario
• Clic Derecho: Dibujar con color secundario
• Activa sombra y mantén el jugador con botón derecho y arrastra para crear una estela de movimiento
• Usa 'Limpiar Sombras' para eliminar todas las flechas de movimiento`}[l])};document.getElementById("toggleShadowBtn").onclick=()=>{G=!G,P()};document.getElementById("downloadBtn").onclick=()=>{E.trackDownload();const t=document.createElement("canvas");t.width=w.clientWidth,t.height=w.clientHeight;const e=t.getContext("2d"),i=new Image;i.crossOrigin="anonymous",i.onload=()=>{e.drawImage(i,0,0,t.width,t.height),e.drawImage(o,0,0);let n=0;const s=A.length;if(s===0){U(t);return}A.forEach(d=>{const p=new Image;p.onload=()=>{const c=d.size||29,m=document.createElement("canvas");m.width=c,m.height=c;const x=m.getContext("2d");x.beginPath(),x.arc(c/2,c/2,c/2-2,0,Math.PI*2),x.fillStyle=getComputedStyle(d.el).backgroundColor,x.fill(),x.strokeStyle=getComputedStyle(d.el).borderColor,x.lineWidth=2,x.stroke(),d.id&&(x.font=`bold ${Math.max(10,c*.4)}px Arial, sans-serif`,x.fillStyle=getComputedStyle(d.el).color,x.textAlign="center",x.textBaseline="middle",x.fillText(d.el.textContent,c/2,c/2));const z=w.getBoundingClientRect(),O=d.x*z.width-c/2,Q=d.y*z.height-c/2;e.drawImage(m,O,Q),n++,n===s&&U(t)},p.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"})};const r=L[b][v];i.src=r.backgroundImage};function U(t){const e=document.createElement("a");e.download=`quadro-tatico-${b}-${v}.png`,e.href=t.toDataURL("image/png"),e.click()}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("drawOffBtn");t&&t.click(),W(),P(),o&&w&&j(),setTimeout(()=>{E.trackVisit()},100)});
